{"ast":null,"code":"import _asyncToGenerator from \"/home/ramon/Desktop/Institut Lacet\\xE0nia/S\\xEDntesi/Projecte/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { importJWK } from '../key/import.js';\nimport { JWKSInvalid, JOSENotSupported, JWKSNoMatchingKey, JWKSMultipleMatchingKeys } from '../util/errors.js';\nimport isObject from '../lib/is_object.js';\n\nfunction getKtyFromAlg(alg) {\n  switch (typeof alg === 'string' && alg.slice(0, 2)) {\n    case 'RS':\n    case 'PS':\n      return 'RSA';\n\n    case 'ES':\n      return 'EC';\n\n    case 'Ed':\n      return 'OKP';\n\n    default:\n      throw new JOSENotSupported('Unsupported \"alg\" value for a JSON Web Key Set');\n  }\n}\n\nexport function isJWKSLike(jwks) {\n  return jwks && typeof jwks === 'object' && Array.isArray(jwks.keys) && jwks.keys.every(isJWKLike);\n}\n\nfunction isJWKLike(key) {\n  return isObject(key);\n}\n\nfunction clone(obj) {\n  if (typeof structuredClone === 'function') {\n    return structuredClone(obj);\n  }\n\n  return JSON.parse(JSON.stringify(obj));\n}\n\nexport class LocalJWKSet {\n  constructor(jwks) {\n    this._cached = new WeakMap();\n\n    if (!isJWKSLike(jwks)) {\n      throw new JWKSInvalid('JSON Web Key Set malformed');\n    }\n\n    this._jwks = clone(jwks);\n  }\n\n  getKey(protectedHeader, token) {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      const {\n        alg,\n        kid\n      } = { ...protectedHeader,\n        ...token.header\n      };\n      const kty = getKtyFromAlg(alg);\n\n      const candidates = _this._jwks.keys.filter(jwk => {\n        let candidate = kty === jwk.kty;\n\n        if (candidate && typeof kid === 'string') {\n          candidate = kid === jwk.kid;\n        }\n\n        if (candidate && typeof jwk.alg === 'string') {\n          candidate = alg === jwk.alg;\n        }\n\n        if (candidate && typeof jwk.use === 'string') {\n          candidate = jwk.use === 'sig';\n        }\n\n        if (candidate && Array.isArray(jwk.key_ops)) {\n          candidate = jwk.key_ops.includes('verify');\n        }\n\n        if (candidate && alg === 'EdDSA') {\n          candidate = jwk.crv === 'Ed25519' || jwk.crv === 'Ed448';\n        }\n\n        if (candidate) {\n          switch (alg) {\n            case 'ES256':\n              candidate = jwk.crv === 'P-256';\n              break;\n\n            case 'ES256K':\n              candidate = jwk.crv === 'secp256k1';\n              break;\n\n            case 'ES384':\n              candidate = jwk.crv === 'P-384';\n              break;\n\n            case 'ES512':\n              candidate = jwk.crv === 'P-521';\n              break;\n          }\n        }\n\n        return candidate;\n      });\n\n      const {\n        0: jwk,\n        length\n      } = candidates;\n\n      if (length === 0) {\n        throw new JWKSNoMatchingKey();\n      } else if (length !== 1) {\n        throw new JWKSMultipleMatchingKeys();\n      }\n\n      const cached = _this._cached.get(jwk) || _this._cached.set(jwk, {}).get(jwk);\n\n      if (cached[alg] === undefined) {\n        const keyObject = yield importJWK({ ...jwk,\n          ext: true\n        }, alg);\n\n        if (keyObject instanceof Uint8Array || keyObject.type !== 'public') {\n          throw new JWKSInvalid('JSON Web Key Set members must be public keys');\n        }\n\n        cached[alg] = keyObject;\n      }\n\n      return cached[alg];\n    })();\n  }\n\n}\nexport function createLocalJWKSet(jwks) {\n  return LocalJWKSet.prototype.getKey.bind(new LocalJWKSet(jwks));\n}","map":{"version":3,"sources":["/home/ramon/Desktop/Institut Lacetània/Síntesi/Projecte/node_modules/jose/dist/browser/jwks/local.js"],"names":["importJWK","JWKSInvalid","JOSENotSupported","JWKSNoMatchingKey","JWKSMultipleMatchingKeys","isObject","getKtyFromAlg","alg","slice","isJWKSLike","jwks","Array","isArray","keys","every","isJWKLike","key","clone","obj","structuredClone","JSON","parse","stringify","LocalJWKSet","constructor","_cached","WeakMap","_jwks","getKey","protectedHeader","token","kid","header","kty","candidates","filter","jwk","candidate","use","key_ops","includes","crv","length","cached","get","set","undefined","keyObject","ext","Uint8Array","type","createLocalJWKSet","prototype","bind"],"mappings":"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","sourcesContent":["import { importJWK } from '../key/import.js';\nimport { JWKSInvalid, JOSENotSupported, JWKSNoMatchingKey, JWKSMultipleMatchingKeys, } from '../util/errors.js';\nimport isObject from '../lib/is_object.js';\nfunction getKtyFromAlg(alg) {\n    switch (typeof alg === 'string' && alg.slice(0, 2)) {\n        case 'RS':\n        case 'PS':\n            return 'RSA';\n        case 'ES':\n            return 'EC';\n        case 'Ed':\n            return 'OKP';\n        default:\n            throw new JOSENotSupported('Unsupported \"alg\" value for a JSON Web Key Set');\n    }\n}\nexport function isJWKSLike(jwks) {\n    return (jwks &&\n        typeof jwks === 'object' &&\n        Array.isArray(jwks.keys) &&\n        jwks.keys.every(isJWKLike));\n}\nfunction isJWKLike(key) {\n    return isObject(key);\n}\nfunction clone(obj) {\n    if (typeof structuredClone === 'function') {\n        return structuredClone(obj);\n    }\n    return JSON.parse(JSON.stringify(obj));\n}\nexport class LocalJWKSet {\n    constructor(jwks) {\n        this._cached = new WeakMap();\n        if (!isJWKSLike(jwks)) {\n            throw new JWKSInvalid('JSON Web Key Set malformed');\n        }\n        this._jwks = clone(jwks);\n    }\n    async getKey(protectedHeader, token) {\n        const { alg, kid } = { ...protectedHeader, ...token.header };\n        const kty = getKtyFromAlg(alg);\n        const candidates = this._jwks.keys.filter((jwk) => {\n            let candidate = kty === jwk.kty;\n            if (candidate && typeof kid === 'string') {\n                candidate = kid === jwk.kid;\n            }\n            if (candidate && typeof jwk.alg === 'string') {\n                candidate = alg === jwk.alg;\n            }\n            if (candidate && typeof jwk.use === 'string') {\n                candidate = jwk.use === 'sig';\n            }\n            if (candidate && Array.isArray(jwk.key_ops)) {\n                candidate = jwk.key_ops.includes('verify');\n            }\n            if (candidate && alg === 'EdDSA') {\n                candidate = jwk.crv === 'Ed25519' || jwk.crv === 'Ed448';\n            }\n            if (candidate) {\n                switch (alg) {\n                    case 'ES256':\n                        candidate = jwk.crv === 'P-256';\n                        break;\n                    case 'ES256K':\n                        candidate = jwk.crv === 'secp256k1';\n                        break;\n                    case 'ES384':\n                        candidate = jwk.crv === 'P-384';\n                        break;\n                    case 'ES512':\n                        candidate = jwk.crv === 'P-521';\n                        break;\n                }\n            }\n            return candidate;\n        });\n        const { 0: jwk, length } = candidates;\n        if (length === 0) {\n            throw new JWKSNoMatchingKey();\n        }\n        else if (length !== 1) {\n            throw new JWKSMultipleMatchingKeys();\n        }\n        const cached = this._cached.get(jwk) || this._cached.set(jwk, {}).get(jwk);\n        if (cached[alg] === undefined) {\n            const keyObject = await importJWK({ ...jwk, ext: true }, alg);\n            if (keyObject instanceof Uint8Array || keyObject.type !== 'public') {\n                throw new JWKSInvalid('JSON Web Key Set members must be public keys');\n            }\n            cached[alg] = keyObject;\n        }\n        return cached[alg];\n    }\n}\nexport function createLocalJWKSet(jwks) {\n    return LocalJWKSet.prototype.getKey.bind(new LocalJWKSet(jwks));\n}\n"]},"metadata":{},"sourceType":"module"}