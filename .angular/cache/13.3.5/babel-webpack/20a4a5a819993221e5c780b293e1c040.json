{"ast":null,"code":"import _asyncToGenerator from \"/home/ramon/Desktop/Institut Lacet\\xE0nia/S\\xEDntesi/Projecte/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { CompactEncrypt } from '../jwe/compact/encrypt.js';\nimport { encoder } from '../lib/buffer_utils.js';\nimport { ProduceJWT } from './produce.js';\nexport class EncryptJWT extends ProduceJWT {\n  setProtectedHeader(protectedHeader) {\n    if (this._protectedHeader) {\n      throw new TypeError('setProtectedHeader can only be called once');\n    }\n\n    this._protectedHeader = protectedHeader;\n    return this;\n  }\n\n  setKeyManagementParameters(parameters) {\n    if (this._keyManagementParameters) {\n      throw new TypeError('setKeyManagementParameters can only be called once');\n    }\n\n    this._keyManagementParameters = parameters;\n    return this;\n  }\n\n  setContentEncryptionKey(cek) {\n    if (this._cek) {\n      throw new TypeError('setContentEncryptionKey can only be called once');\n    }\n\n    this._cek = cek;\n    return this;\n  }\n\n  setInitializationVector(iv) {\n    if (this._iv) {\n      throw new TypeError('setInitializationVector can only be called once');\n    }\n\n    this._iv = iv;\n    return this;\n  }\n\n  replicateIssuerAsHeader() {\n    this._replicateIssuerAsHeader = true;\n    return this;\n  }\n\n  replicateSubjectAsHeader() {\n    this._replicateSubjectAsHeader = true;\n    return this;\n  }\n\n  replicateAudienceAsHeader() {\n    this._replicateAudienceAsHeader = true;\n    return this;\n  }\n\n  encrypt(key, options) {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      const enc = new CompactEncrypt(encoder.encode(JSON.stringify(_this._payload)));\n\n      if (_this._replicateIssuerAsHeader) {\n        _this._protectedHeader = { ..._this._protectedHeader,\n          iss: _this._payload.iss\n        };\n      }\n\n      if (_this._replicateSubjectAsHeader) {\n        _this._protectedHeader = { ..._this._protectedHeader,\n          sub: _this._payload.sub\n        };\n      }\n\n      if (_this._replicateAudienceAsHeader) {\n        _this._protectedHeader = { ..._this._protectedHeader,\n          aud: _this._payload.aud\n        };\n      }\n\n      enc.setProtectedHeader(_this._protectedHeader);\n\n      if (_this._iv) {\n        enc.setInitializationVector(_this._iv);\n      }\n\n      if (_this._cek) {\n        enc.setContentEncryptionKey(_this._cek);\n      }\n\n      if (_this._keyManagementParameters) {\n        enc.setKeyManagementParameters(_this._keyManagementParameters);\n      }\n\n      return enc.encrypt(key, options);\n    })();\n  }\n\n}","map":{"version":3,"sources":["/home/ramon/Desktop/Institut Lacetània/Síntesi/Projecte/node_modules/jose/dist/browser/jwt/encrypt.js"],"names":["CompactEncrypt","encoder","ProduceJWT","EncryptJWT","setProtectedHeader","protectedHeader","_protectedHeader","TypeError","setKeyManagementParameters","parameters","_keyManagementParameters","setContentEncryptionKey","cek","_cek","setInitializationVector","iv","_iv","replicateIssuerAsHeader","_replicateIssuerAsHeader","replicateSubjectAsHeader","_replicateSubjectAsHeader","replicateAudienceAsHeader","_replicateAudienceAsHeader","encrypt","key","options","enc","encode","JSON","stringify","_payload","iss","sub","aud"],"mappings":"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","sourcesContent":["import { CompactEncrypt } from '../jwe/compact/encrypt.js';\nimport { encoder } from '../lib/buffer_utils.js';\nimport { ProduceJWT } from './produce.js';\nexport class EncryptJWT extends ProduceJWT {\n    setProtectedHeader(protectedHeader) {\n        if (this._protectedHeader) {\n            throw new TypeError('setProtectedHeader can only be called once');\n        }\n        this._protectedHeader = protectedHeader;\n        return this;\n    }\n    setKeyManagementParameters(parameters) {\n        if (this._keyManagementParameters) {\n            throw new TypeError('setKeyManagementParameters can only be called once');\n        }\n        this._keyManagementParameters = parameters;\n        return this;\n    }\n    setContentEncryptionKey(cek) {\n        if (this._cek) {\n            throw new TypeError('setContentEncryptionKey can only be called once');\n        }\n        this._cek = cek;\n        return this;\n    }\n    setInitializationVector(iv) {\n        if (this._iv) {\n            throw new TypeError('setInitializationVector can only be called once');\n        }\n        this._iv = iv;\n        return this;\n    }\n    replicateIssuerAsHeader() {\n        this._replicateIssuerAsHeader = true;\n        return this;\n    }\n    replicateSubjectAsHeader() {\n        this._replicateSubjectAsHeader = true;\n        return this;\n    }\n    replicateAudienceAsHeader() {\n        this._replicateAudienceAsHeader = true;\n        return this;\n    }\n    async encrypt(key, options) {\n        const enc = new CompactEncrypt(encoder.encode(JSON.stringify(this._payload)));\n        if (this._replicateIssuerAsHeader) {\n            this._protectedHeader = { ...this._protectedHeader, iss: this._payload.iss };\n        }\n        if (this._replicateSubjectAsHeader) {\n            this._protectedHeader = { ...this._protectedHeader, sub: this._payload.sub };\n        }\n        if (this._replicateAudienceAsHeader) {\n            this._protectedHeader = { ...this._protectedHeader, aud: this._payload.aud };\n        }\n        enc.setProtectedHeader(this._protectedHeader);\n        if (this._iv) {\n            enc.setInitializationVector(this._iv);\n        }\n        if (this._cek) {\n            enc.setContentEncryptionKey(this._cek);\n        }\n        if (this._keyManagementParameters) {\n            enc.setKeyManagementParameters(this._keyManagementParameters);\n        }\n        return enc.encrypt(key, options);\n    }\n}\n"]},"metadata":{},"sourceType":"module"}