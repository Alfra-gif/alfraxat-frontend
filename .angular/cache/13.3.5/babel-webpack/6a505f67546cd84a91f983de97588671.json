{"ast":null,"code":"import _asyncToGenerator from \"/home/ramon/Desktop/Institut Lacet\\xE0nia/S\\xEDntesi/Projecte/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { unwrap as aesKw } from '../runtime/aeskw.js';\nimport * as ECDH from '../runtime/ecdhes.js';\nimport { decrypt as pbes2Kw } from '../runtime/pbes2kw.js';\nimport { decrypt as rsaEs } from '../runtime/rsaes.js';\nimport { decode as base64url } from '../runtime/base64url.js';\nimport { JOSENotSupported, JWEInvalid } from '../util/errors.js';\nimport { bitLength as cekLength } from '../lib/cek.js';\nimport { importJWK } from '../key/import.js';\nimport checkKeyType from './check_key_type.js';\nimport isObject from './is_object.js';\nimport { unwrap as aesGcmKw } from './aesgcmkw.js';\n\nfunction decryptKeyManagement(_x, _x2, _x3, _x4) {\n  return _decryptKeyManagement.apply(this, arguments);\n}\n\nfunction _decryptKeyManagement() {\n  _decryptKeyManagement = _asyncToGenerator(function* (alg, key, encryptedKey, joseHeader) {\n    checkKeyType(alg, key, 'decrypt');\n\n    switch (alg) {\n      case 'dir':\n        {\n          if (encryptedKey !== undefined) throw new JWEInvalid('Encountered unexpected JWE Encrypted Key');\n          return key;\n        }\n\n      case 'ECDH-ES':\n        if (encryptedKey !== undefined) throw new JWEInvalid('Encountered unexpected JWE Encrypted Key');\n\n      case 'ECDH-ES+A128KW':\n      case 'ECDH-ES+A192KW':\n      case 'ECDH-ES+A256KW':\n        {\n          if (!isObject(joseHeader.epk)) throw new JWEInvalid(`JOSE Header \"epk\" (Ephemeral Public Key) missing or invalid`);\n          if (!ECDH.ecdhAllowed(key)) throw new JOSENotSupported('ECDH with the provided key is not allowed or not supported by your javascript runtime');\n          const epk = yield importJWK(joseHeader.epk, alg);\n          let partyUInfo;\n          let partyVInfo;\n\n          if (joseHeader.apu !== undefined) {\n            if (typeof joseHeader.apu !== 'string') throw new JWEInvalid(`JOSE Header \"apu\" (Agreement PartyUInfo) invalid`);\n            partyUInfo = base64url(joseHeader.apu);\n          }\n\n          if (joseHeader.apv !== undefined) {\n            if (typeof joseHeader.apv !== 'string') throw new JWEInvalid(`JOSE Header \"apv\" (Agreement PartyVInfo) invalid`);\n            partyVInfo = base64url(joseHeader.apv);\n          }\n\n          const sharedSecret = yield ECDH.deriveKey(epk, key, alg === 'ECDH-ES' ? joseHeader.enc : alg, alg === 'ECDH-ES' ? cekLength(joseHeader.enc) : parseInt(alg.slice(-5, -2), 10), partyUInfo, partyVInfo);\n          if (alg === 'ECDH-ES') return sharedSecret;\n          if (encryptedKey === undefined) throw new JWEInvalid('JWE Encrypted Key missing');\n          return aesKw(alg.slice(-6), sharedSecret, encryptedKey);\n        }\n\n      case 'RSA1_5':\n      case 'RSA-OAEP':\n      case 'RSA-OAEP-256':\n      case 'RSA-OAEP-384':\n      case 'RSA-OAEP-512':\n        {\n          if (encryptedKey === undefined) throw new JWEInvalid('JWE Encrypted Key missing');\n          return rsaEs(alg, key, encryptedKey);\n        }\n\n      case 'PBES2-HS256+A128KW':\n      case 'PBES2-HS384+A192KW':\n      case 'PBES2-HS512+A256KW':\n        {\n          if (encryptedKey === undefined) throw new JWEInvalid('JWE Encrypted Key missing');\n          if (typeof joseHeader.p2c !== 'number') throw new JWEInvalid(`JOSE Header \"p2c\" (PBES2 Count) missing or invalid`);\n          if (typeof joseHeader.p2s !== 'string') throw new JWEInvalid(`JOSE Header \"p2s\" (PBES2 Salt) missing or invalid`);\n          return pbes2Kw(alg, key, encryptedKey, joseHeader.p2c, base64url(joseHeader.p2s));\n        }\n\n      case 'A128KW':\n      case 'A192KW':\n      case 'A256KW':\n        {\n          if (encryptedKey === undefined) throw new JWEInvalid('JWE Encrypted Key missing');\n          return aesKw(alg, key, encryptedKey);\n        }\n\n      case 'A128GCMKW':\n      case 'A192GCMKW':\n      case 'A256GCMKW':\n        {\n          if (encryptedKey === undefined) throw new JWEInvalid('JWE Encrypted Key missing');\n          if (typeof joseHeader.iv !== 'string') throw new JWEInvalid(`JOSE Header \"iv\" (Initialization Vector) missing or invalid`);\n          if (typeof joseHeader.tag !== 'string') throw new JWEInvalid(`JOSE Header \"tag\" (Authentication Tag) missing or invalid`);\n          const iv = base64url(joseHeader.iv);\n          const tag = base64url(joseHeader.tag);\n          return aesGcmKw(alg, key, encryptedKey, iv, tag);\n        }\n\n      default:\n        {\n          throw new JOSENotSupported('Invalid or unsupported \"alg\" (JWE Algorithm) header value');\n        }\n    }\n  });\n  return _decryptKeyManagement.apply(this, arguments);\n}\n\nexport default decryptKeyManagement;","map":{"version":3,"sources":["/home/ramon/Desktop/Institut Lacetània/Síntesi/Projecte/node_modules/jose/dist/browser/lib/decrypt_key_management.js"],"names":["unwrap","aesKw","ECDH","decrypt","pbes2Kw","rsaEs","decode","base64url","JOSENotSupported","JWEInvalid","bitLength","cekLength","importJWK","checkKeyType","isObject","aesGcmKw","decryptKeyManagement","alg","key","encryptedKey","joseHeader","undefined","epk","ecdhAllowed","partyUInfo","partyVInfo","apu","apv","sharedSecret","deriveKey","enc","parseInt","slice","p2c","p2s","iv","tag"],"mappings":"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","sourcesContent":["import { unwrap as aesKw } from '../runtime/aeskw.js';\nimport * as ECDH from '../runtime/ecdhes.js';\nimport { decrypt as pbes2Kw } from '../runtime/pbes2kw.js';\nimport { decrypt as rsaEs } from '../runtime/rsaes.js';\nimport { decode as base64url } from '../runtime/base64url.js';\nimport { JOSENotSupported, JWEInvalid } from '../util/errors.js';\nimport { bitLength as cekLength } from '../lib/cek.js';\nimport { importJWK } from '../key/import.js';\nimport checkKeyType from './check_key_type.js';\nimport isObject from './is_object.js';\nimport { unwrap as aesGcmKw } from './aesgcmkw.js';\nasync function decryptKeyManagement(alg, key, encryptedKey, joseHeader) {\n    checkKeyType(alg, key, 'decrypt');\n    switch (alg) {\n        case 'dir': {\n            if (encryptedKey !== undefined)\n                throw new JWEInvalid('Encountered unexpected JWE Encrypted Key');\n            return key;\n        }\n        case 'ECDH-ES':\n            if (encryptedKey !== undefined)\n                throw new JWEInvalid('Encountered unexpected JWE Encrypted Key');\n        case 'ECDH-ES+A128KW':\n        case 'ECDH-ES+A192KW':\n        case 'ECDH-ES+A256KW': {\n            if (!isObject(joseHeader.epk))\n                throw new JWEInvalid(`JOSE Header \"epk\" (Ephemeral Public Key) missing or invalid`);\n            if (!ECDH.ecdhAllowed(key))\n                throw new JOSENotSupported('ECDH with the provided key is not allowed or not supported by your javascript runtime');\n            const epk = await importJWK(joseHeader.epk, alg);\n            let partyUInfo;\n            let partyVInfo;\n            if (joseHeader.apu !== undefined) {\n                if (typeof joseHeader.apu !== 'string')\n                    throw new JWEInvalid(`JOSE Header \"apu\" (Agreement PartyUInfo) invalid`);\n                partyUInfo = base64url(joseHeader.apu);\n            }\n            if (joseHeader.apv !== undefined) {\n                if (typeof joseHeader.apv !== 'string')\n                    throw new JWEInvalid(`JOSE Header \"apv\" (Agreement PartyVInfo) invalid`);\n                partyVInfo = base64url(joseHeader.apv);\n            }\n            const sharedSecret = await ECDH.deriveKey(epk, key, alg === 'ECDH-ES' ? joseHeader.enc : alg, alg === 'ECDH-ES' ? cekLength(joseHeader.enc) : parseInt(alg.slice(-5, -2), 10), partyUInfo, partyVInfo);\n            if (alg === 'ECDH-ES')\n                return sharedSecret;\n            if (encryptedKey === undefined)\n                throw new JWEInvalid('JWE Encrypted Key missing');\n            return aesKw(alg.slice(-6), sharedSecret, encryptedKey);\n        }\n        case 'RSA1_5':\n        case 'RSA-OAEP':\n        case 'RSA-OAEP-256':\n        case 'RSA-OAEP-384':\n        case 'RSA-OAEP-512': {\n            if (encryptedKey === undefined)\n                throw new JWEInvalid('JWE Encrypted Key missing');\n            return rsaEs(alg, key, encryptedKey);\n        }\n        case 'PBES2-HS256+A128KW':\n        case 'PBES2-HS384+A192KW':\n        case 'PBES2-HS512+A256KW': {\n            if (encryptedKey === undefined)\n                throw new JWEInvalid('JWE Encrypted Key missing');\n            if (typeof joseHeader.p2c !== 'number')\n                throw new JWEInvalid(`JOSE Header \"p2c\" (PBES2 Count) missing or invalid`);\n            if (typeof joseHeader.p2s !== 'string')\n                throw new JWEInvalid(`JOSE Header \"p2s\" (PBES2 Salt) missing or invalid`);\n            return pbes2Kw(alg, key, encryptedKey, joseHeader.p2c, base64url(joseHeader.p2s));\n        }\n        case 'A128KW':\n        case 'A192KW':\n        case 'A256KW': {\n            if (encryptedKey === undefined)\n                throw new JWEInvalid('JWE Encrypted Key missing');\n            return aesKw(alg, key, encryptedKey);\n        }\n        case 'A128GCMKW':\n        case 'A192GCMKW':\n        case 'A256GCMKW': {\n            if (encryptedKey === undefined)\n                throw new JWEInvalid('JWE Encrypted Key missing');\n            if (typeof joseHeader.iv !== 'string')\n                throw new JWEInvalid(`JOSE Header \"iv\" (Initialization Vector) missing or invalid`);\n            if (typeof joseHeader.tag !== 'string')\n                throw new JWEInvalid(`JOSE Header \"tag\" (Authentication Tag) missing or invalid`);\n            const iv = base64url(joseHeader.iv);\n            const tag = base64url(joseHeader.tag);\n            return aesGcmKw(alg, key, encryptedKey, iv, tag);\n        }\n        default: {\n            throw new JOSENotSupported('Invalid or unsupported \"alg\" (JWE Algorithm) header value');\n        }\n    }\n}\nexport default decryptKeyManagement;\n"]},"metadata":{},"sourceType":"module"}